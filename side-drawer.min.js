/***
Copyright 2016 TJ Woon

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
***/
(function(){"use strict";var t,s,i,e,o,h;e=function(){var t,s;return s=this,t=this.fullyOpen,null==t&&(t=i.call(this)),this.holder.show(),this.drawer.css("transition","transform "+this.options.speed+"s ease-out").css("transform","translate3d("+t+"px,0px,0px)"),this.holder.css("transition","background "+this.options.speed+"s ease-out").css("background","rgba(0,0,0,"+this.options.opacity+")"),this.previousOverflow=this.parent.css("overflow"),this.parent.css("overflow","hidden"),this.fingerId=void 0,this.handleEvent=o},s=function(){var t;return t=this,this.drawer.css("transition","transform "+this.options.speed+"s ease-out").css("transform","translate3d(0px,0px,0px)"),this.holder.css("transition","background "+this.options.speed+"s ease-out").css("background","rgba(0,0,0,0)"),this.parent.css("overflow",this.previousOverflow),this.fingerId=void 0,setTimeout(function(){return t.holder.hide()},1e3*this.options.speed),this.handleEvent=h},i=function(){var t;return this.holder.css("visibility","hidden").css("display","block"),t=this.drawer.outerWidth(),this.holder.css("visibility","visible").css("display","none"),t},h=function(t){var o,h,r,n,f,a,d,l,c,u,p,v,g,w,y,m;switch(t.type){case"touchstart":if(d=this.holder[0].getBoundingClientRect().left,null==this.fingerId)return y=t.changedTouches[0],y.clientX-d<=this.options.sensitivity&&(this.fingerId=y.identifier,this.startX=y.clientX,this.offset=0,this.offsetList=[],this.fullyOpen=i.call(this),this.drawer.css("transition","none"),this.holder.css("transition","none")),t.stopPropagation();break;case"touchmove":if(null==this.fingerId)return;for(p=t.changedTouches,g=[],n=0,l=p.length;l>n;n++)if(y=p[n],this.fingerId===y.identifier){for(h=Math.round(y.clientX-this.startX),this.offset=Math.max(0,Math.min(this.fullyOpen,h)),this.drawer.css("transform","translate3d("+this.offset+"px,0px,0px)"),this.offsetList.push({offset:this.offset,time:(new Date).getTime()});this.offsetList.length>=10;)this.offsetList.shift();o=this.offset/this.fullyOpen*this.options.opacity,this.holder.css("background","rgba(0,0,0,"+o.toFixed(3)+")"),this.offset>0?this.holder.show():this.holder.hide(),t.stopPropagation(),g.push(t.preventDefault())}else g.push(void 0);return g;case"touchend":case"touchcancel":if(null==this.fingerId)return;for(v=t.changedTouches,w=[],f=0,c=v.length;c>f;f++){if(y=v[f],this.fingerId===y.identifier){for(u=(new Date).getTime();this.offsetList.length&&u-this.offsetList[0].time>300;)this.offsetList.shift();r=this.offsetList[0],a=this.offsetList.slice(-1)[0],m=r===a?0:(this.offset-r.offset)/(u-r.time)*1e3,m>=0&&(m>=this.options.threshold||this.offset>=this.options.offset)?e.call(this):s.call(this),t.stopPropagation(),this.fingerId=void 0,this.startX=void 0,this.offset=void 0,this.offsetList=void 0,this.fullyOpen=void 0,this.previousOverflow=void 0;break}w.push(void 0)}return w}},o=function(t){var i,o,h,r,n,f,a,d,l,c,u,p,v,g,w,y;switch(t.type){case"touchstart":if(g=this.drawer[0].getBoundingClientRect().right,null==this.fingerId)return w=t.changedTouches[0],g-this.options.sensitivity<=w.clientX&&(this.fingerId=w.identifier,this.startX=w.clientX,this.fullyOpen=this.drawer.outerWidth(),this.offset=this.fullyOpen,this.offsetList=[],this.drawer.css("transition","none"),this.holder.css("transition","none")),t.stopPropagation();break;case"touchmove":if(null==this.fingerId)return;for(c=t.changedTouches,p=[],r=0,a=c.length;a>r;r++)if(w=c[r],this.fingerId===w.identifier){for(o=Math.round(w.clientX-this.startX),this.offset=Math.max(0,Math.min(this.fullyOpen,this.fullyOpen+o)),this.drawer.css("transform","translate3d("+this.offset+"px,0px,0px)"),this.offsetList.push({offset:this.offset,time:(new Date).getTime()});this.offsetList.length>=10;)this.offsetList.shift();i=this.offset/this.fullyOpen*this.options.opacity,this.holder.css("background","rgba(0,0,0,"+i.toFixed(3)+")"),this.offset>0?this.holder.show():this.holder.hide(),t.stopPropagation(),p.push(t.preventDefault())}else p.push(void 0);return p;case"touchend":case"touchcancel":if(null==this.fingerId)return;for(u=t.changedTouches,v=[],n=0,d=u.length;d>n;n++){if(w=u[n],this.fingerId===w.identifier){for(l=(new Date).getTime();this.offsetList.length&&l-this.offsetList[0].time>300;)this.offsetList.shift();h=this.offsetList[0],f=this.offsetList.slice(-1)[0],y=h===f?0:(this.offset-h.offset)/(l-h.time)*1e3,0>y&&(y<=-this.options.threshold||this.offset<=this.fullyOpen-this.options.offset)?s.call(this):e.call(this),t.stopPropagation(),this.fingerId=void 0,this.startX=void 0,this.offset=void 0,this.offsetList=void 0,this.fullyOpen=void 0,this.previousOverflow=void 0;break}v.push(void 0)}return v}},t=function(t,i){var e,o,r,n,f;for(null==i&&(i={}),n=this,this.options=$.extend({sensitivity:60,threshold:300,offset:120,opacity:.6,speed:.2},i),this.holder=$(t),this.drawer=this.holder.children().eq(0),this.parent=this.holder.parent(),this.fingerId=void 0,this.startX=void 0,this.offset=void 0,this.offsetList=void 0,this.fullyOpen=void 0,this.previousOverflow=void 0,$(this.holder).Touch(),$(this.holder).on("tap",function(){return s.call(n)}),$(this.drawer).on("tap",function(t){return t.stopPropagation()}),this.holder.hide(),this.holder.css("position","absolute"),this.holder.css("top","0px"),this.holder.css("bottom","0px"),this.holder.css("left","0px"),this.holder.css("right","0px"),this.holder.css("z-index","9000"),this.drawer.css("position","absolute"),this.drawer.css("top","0px"),this.drawer.css("bottom","0px"),this.drawer.css("left","0px"),this.drawer.css("width","calc(100% - 60px)"),this.drawer.css("margin-left","calc(-100% + 60px)"),this.handleEvent=h,f=["touchstart","touchmove","touchend","touchcancel"],o=0,r=f.length;r>o;o++)e=f[o],this.parent[0].addEventListener(e,this,!1);return this},t.prototype.open=function(){return e.call(this)},t.prototype.close=function(){return s.call(this)},t.version="0.0.2",$.fn.SideDrawer=function(s){return this.each(function(){var i;return i=$(this).data("SideDrawer"),null==i&&(i=new t(this,s),$(this).data("SideDrawer",i)),i})},$.SideDrawer=t}).call(this);